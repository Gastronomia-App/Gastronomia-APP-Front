<aside class="aside-form">
    <header class="aside-header flex justify-between align-center">
        <h2>Nuevo gasto</h2>
        <button type="button" class="btn-reset" (click)="onClose()">
            ✕
        </button>
    </header>

    <div class="aside-content">
        @if (errorMessage()) {
            <div class="error-message">
                {{ errorMessage() }}
            </div>
        }

            <fieldset>
                <label for="dateTime">
                    Fecha y Hora <span class="required">*</span>
                </label>
                <input 
                    type="datetime-local" 
                    id="dateTime"
                    name="dateTime"
                    [(ngModel)]="expense.dateTime"
                    (blur)="markAsTouched('dateTime')"
                    [disabled]="isLoading()"
                    [class.error]="getDateTimeError()"
                    required />
                @if (getDateTimeError()) {
                    <span class="field-error">{{ getDateTimeError() }}</span>
                }
            </fieldset>

            <fieldset>
                <app-select-dropdown
                    label="Proveedor"
                    placeholder="Seleccione un proveedor"
                    [options]="suppliers()"
                    [selectedId]="expense.supplierId ?? null"
                    [required]="true"
                    [disabled]="isLoading()"
                    [errorMessage]="getSupplierIdError() ?? ''"
                    (selectionChange)="onSupplierChange($event)">
                </app-select-dropdown>
            </fieldset>

            <fieldset>
                <label for="amount">
                    Monto <span class="required">*</span>
                </label>
                <input 
                    type="number" 
                    id="amount"
                    name="amount"
                    [(ngModel)]="expense.amount"
                    (blur)="markAsTouched('amount')"
                    placeholder="0.00"
                    min="0"
                    step="0.01"
                    [disabled]="isLoading()"
                    [class.error]="getAmountError()"
                    required />
                @if (getAmountError()) {
                    <span class="field-error">{{ getAmountError() }}</span>
                }
            </fieldset>

            <fieldset>
                <label for="comment">Comentario</label>
                <textarea 
                    id="comment"
                    name="comment"
                    [(ngModel)]="expense.comment"
                    placeholder="Descripción breve del gasto (opcional)"
                    [disabled]="isLoading()">
                </textarea>
            </fieldset>
        </div>

        <footer class="aside-footer">
            <button 
                type="button" 
                class="secondary" 
                (click)="onCancel()"
                [disabled]="isLoading()">
                Cancelar
            </button>
            <button 
                type="button" 
                (click)="onSubmit()"
                [disabled]="isLoading()">
                {{ isLoading() ? 'Guardando...' : 'Crear' }}
            </button>
        </footer>
</aside>
