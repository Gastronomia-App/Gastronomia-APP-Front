<!-- Sub-header - full width at top -->
<app-sub-header [tabs]="subHeaderTabs()" [actions]="subHeaderActions()" (actionClick)="onSubHeaderAction($event)">
</app-sub-header>

<div class="page-container">
  <div class="page-content">
    <div class="seating-section">
      @if (loading()) {
      <p>Cargando ubicaciones...</p>
      } @else if (error()) {
      <p class="error">{{ error() }}</p>
      } @else {
      @if (!editMode()) {
      @if (seatings().length > 0) {
      <app-seating-status-view [seatings]="seatings()" (select)="onSelectSeating($event)">
      </app-seating-status-view>
      } @else {
      <p>No hay ubicaciones registradas. Entr√° en <strong>modo edici√≥n</strong> para crear la primera.</p>
      }
      } @else {
      <!-- Editor: siempre visible en modo edici√≥n -->
      <app-seating-grid-editor
    #gridEditor
    [zoomLevel]="zoomLevel()"
    [seatingsInput]="seatings()"
    [draftSeat]="draftSeating()"
    [editedSeat]="selectedSeating()"
    (draftRequested)="onDraftRequested($event)"
    (draftClear)="draftSeating.set(null)"
    (editRequested)="onEditFromGrid($event)"
    (moveRequested)="onMoveRequested($event)"
    (shapeSizeRequested)="onShapeSizeRequested($event)"
    (editingCancelled)="onEditingCancelled()"
    (liveChange)="onFormChanged($event)">
  </app-seating-grid-editor>
      }
      }
    </div>
  </div>

  <!-- ASIDE -->
  <aside class="aside-panel seating-aside">
    @if (editMode()) {
    @if (draftSeating()) {
    <app-seating-form [seating]="draftSeating()!" mode="create" (closed)="onFormClosed()"
      (changed)="onFormChanged($event)">
    </app-seating-form>
    } @else if (selectedSeating()) {
    <app-seating-form [seating]="selectedSeating()!" mode="edit" (closed)="onFormClosed()"
      (changed)="onFormChanged($event)">
    </app-seating-form>
    } @else {
    <div class="aside-panel-wrapper">
      <div class="aside-panel-header">
        <h2>Modo edici√≥n del sal√≥n</h2>
      </div>
      <div class="aside-panel-container">
        <section>
          <p class="text-muted">Configur√° la disposici√≥n, forma y tama√±o de las ubicaciones.</p>
          <div class="info-section">
            <div class="zoom-control">
              <label for="zoomRange">Nivel de Zoom</label>
              <input id="zoomRange" type="range" min="1" max="20" [value]="zoomLevel()"
                (input)="onZoomChange($any($event.target).value)" />
              <span>{{ zoomLevel() }}</span>
            </div>
            <h3 class="section-title">Acciones disponibles</h3>
            <ul class="info-list">
              <li><span class="icon">‚ûï</span>
                <div><strong>Agregar:</strong><span class="text-muted"> clic en una celda vac√≠a.</span></div>
              </li>
              <li><span class="icon">üñ±Ô∏è</span>
                <div><strong>Mover:</strong><span class="text-muted"> arrastr√° y solt√° para cambiar posici√≥n.</span>
                </div>
              </li>
              <li><span class="icon">‚öôÔ∏è</span>
                <div><strong>Editar:</strong><span class="text-muted"> clic en una ubicaci√≥n existente.</span></div>
              </li>
              <li><span class="icon">‚å´</span>
                <div><strong>Eliminar:</strong><span class="text-muted"> seleccion√° y presion√° eliminar.</span></div>
              </li>
            </ul>
          </div>
          <div class="alert-info">
            <h4>Reglas del modo edici√≥n</h4>
            <ul>
              <li>No pod√©s superponer ubicaciones en la misma celda.</li>
              <li>No se pueden eliminar ubicaciones ocupadas o en facturaci√≥n.</li>
              <li>Los cambios se aplican solo al <strong>guardar</strong>.</li>
              <li>Los cambios no guardados se pierden al salir del modo edici√≥n.</li>
            </ul>
          </div>
          <div class="tip-box">
            <span class="emoji">üí°</span>
            <p>Us√° este modo para reorganizar el sal√≥n de forma clara y ordenada.</p>
          </div>
        </section>
      </div>
    </div>
    }
    } @else {
    <div class="aside-panel-wrapper">
      <div class="aside-panel-header">
        <h2>Detalles del sal√≥n</h2>
      </div>
      <div class="aside-panel-container">
        <section>
          <p class="text-muted">Panel de <strong>gesti√≥n y monitoreo</strong> de ubicaciones.</p>
          <div class="info-section">
            <h3 class="section-title">Estado de las ubicaciones</h3>
            <ul class="status-list">
              <li><span class="status-dot status-free"></span>
                <div><strong>Libres:</strong><span class="text-muted"> disponibles para nuevos clientes.</span></div>
              </li>
              <li><span class="status-dot status-occupied"></span>
                <div><strong>Ocupadas:</strong><span class="text-muted"> en atenci√≥n o consumo activo.</span></div>
              </li>
              <li><span class="status-dot status-billing"></span>
                <div><strong>En facturaci√≥n:</strong><span class="text-muted"> esperando cierre de cuenta.</span></div>
              </li>
            </ul>
          </div>
          <div class="tip-box">
            <span class="emoji">üí°</span>
            <p>Entr√° en <strong>modo edici√≥n</strong> para reorganizar el sal√≥n o agregar nuevas ubicaciones.</p>
          </div>
        </section>
      </div>
    </div>
    }
  </aside>
</div>