<!-- Sub-header - full width at top -->
<app-sub-header
  [tabs]="subHeaderTabs()"
  [actions]="subHeaderActions()"
  (actionClick)="onSubHeaderAction($event)">
</app-sub-header>

<!-- Main content container -->
<div class="page-container">
    <!-- Main content area -->
    <div class="page-content">
        <!-- Grid/Matrix area -->
        <div class="table-section">
            @if (loading()) {
            <p>Cargando mesas...</p>
            } @else if (error()) {
            <p class="error">{{ error() }}</p>
            } @else {
            @if (!editMode()) {
            <!-- vista normal -->
            @if (seatings().length > 0) {
            <app-table-grid [tables]="seatings()" (select)="onSelectTable($event)"></app-table-grid>
            } @else {
            <p>No hay mesas registradas. Entr√° en <strong>modo edici√≥n</strong> para crear la primera.</p>
            }
            } @else {
            <!-- editor: siempre se muestra en modo edici√≥n, aunque no haya mesas -->
            <app-table-grid-editor [draftSeat]="draftSeating()" (draftRequested)="onDraftRequested($event)"
                (editRequested)="onEditFromGrid($event)" (moveRequested)="onMoveRequested($event)">
            </app-table-grid-editor>
            }
            }
        </div>
    </div>
    <!-- ASIDE - always visible, content changes based on mode -->
    <aside class="aside-panel">
        @if (editMode()) {
          @if (draftSeating()) {
            <app-table-form [seating]="draftSeating()!" mode="create" (closed)="onFormClosed()"></app-table-form>
          } @else if (selectedSeating()) {
            <app-table-form [seating]="selectedSeating()!" mode="edit" (closed)="onFormClosed()"></app-table-form>
          } @else {
            <!-- Edit mode info panel -->
            <div class="aside-panel-wrapper">
              <div class="aside-panel-header">
                <h2>Modo edici√≥n del sal√≥n</h2>
              </div>
              
              <div class="aside-panel-container">
                <section>
                  <p class="text-muted">Configur√° la disposici√≥n, forma y tama√±o de las mesas.</p>
                  
                  <div class="info-section">
                    <h3 class="section-title">Acciones disponibles</h3>
                    <ul class="info-list">
                      <li>
                        <span class="icon">‚ûï</span>
                        <div>
                          <strong>Agregar mesa:</strong>
                          <span class="text-muted">clic en una celda vac√≠a.</span>
                        </div>
                      </li>
                      <li>
                        <span class="icon">üñ±Ô∏è</span>
                        <div>
                          <strong>Mover mesa:</strong>
                          <span class="text-muted">arrastr√° y solt√° para cambiar su posici√≥n.</span>
                        </div>
                      </li>
                      <li>
                        <span class="icon">‚öôÔ∏è</span>
                        <div>
                          <strong>Editar:</strong>
                          <span class="text-muted">clic en una mesa existente.</span>
                        </div>
                      </li>
                      <li>
                        <span class="icon">‚å´</span>
                        <div>
                          <strong>Eliminar:</strong>
                          <span class="text-muted">seleccion√° y presion√° el bot√≥n de eliminar.</span>
                        </div>
                      </li>
                    </ul>
                  </div>

                  <div class="alert-info">
                    <h4>Reglas del modo edici√≥n</h4>
                    <ul>
                      <li>No pod√©s superponer mesas en la misma posici√≥n.</li>
                      <li>No se pueden eliminar mesas ocupadas o en facturaci√≥n.</li>
                      <li>Las modificaciones se aplican solo despu√©s de <strong>guardar</strong>.</li>
                      <li>Los cambios no guardados se perder√°n al salir del modo edici√≥n.</li>
                      <li>No pod√©s cambiar el n√∫mero de una mesa por una mesa ya eliminada.</li>
                    </ul>
                  </div>

                  <div class="tip-box">
                    <span class="emoji">üí°</span>
                    <p>Us√° este modo para reorganizar el sal√≥n de forma clara y ordenada.</p>
                  </div>
                </section>
              </div>
            </div>
          }
        } @else {
          <!-- Info mode panel -->
          <div class="aside-panel-wrapper">
            <div class="aside-panel-header">
              <h2>Detalles del sal√≥n</h2>
            </div>
            
            <div class="aside-panel-container">
              <section>
                <p class="text-muted">Panel de <strong>gesti√≥n y monitoreo</strong> de mesas.</p>
                
                <div class="info-section">
                  <h3 class="section-title">Estado de las mesas</h3>
                  <ul class="status-list">
                    <li>
                      <span class="status-dot status-free"></span>
                      <div>
                        <strong>Mesas libres:</strong>
                        <span class="text-muted">disponibles para nuevos clientes.</span>
                      </div>
                    </li>
                    <li>
                      <span class="status-dot status-occupied"></span>
                      <div>
                        <strong>Mesas ocupadas:</strong>
                        <span class="text-muted">en atenci√≥n o consumo activo.</span>
                      </div>
                    </li>
                    <li>
                      <span class="status-dot status-billing"></span>
                      <div>
                        <strong>Mesas en facturaci√≥n:</strong>
                        <span class="text-muted">esperando cierre de cuenta.</span>
                      </div>
                    </li>
                  </ul>
                </div>

                <div class="tip-box">
                  <span class="emoji">üí°</span>
                  <p>Entr√° en <strong>modo edici√≥n</strong> para reorganizar el sal√≥n o agregar nuevas mesas.</p>
                </div>
              </section>
            </div>
          </div>
        }
    </aside>
</div>
