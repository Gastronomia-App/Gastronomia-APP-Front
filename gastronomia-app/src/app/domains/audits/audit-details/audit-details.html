<!-- Aside panel container -->
<aside class="aside-panel">
  <!-- Generic Detail Component with integrated header and footer -->
  <app-detail
    [config]="detailConfig"
    [data]="audit()"
    [showHeader]="true"
    [showFooter]="true"
    (detailClosed)="onClose()"
  />
</aside>

<!-- Cancel Modal -->
<app-confirmation-modal
  [isVisible]="showCancelModal()"
  title="Cancelar Auditoría"
  message="¿Estás seguro de que deseas cancelar esta auditoría? Esta acción no se puede deshacer y la auditoría quedará marcada como cancelada."
  confirmText="Sí, Cancelar Auditoría"
  cancelText="No, Volver"
  [isDanger]="true"
  (confirm)="confirmCancel()"
  (cancel)="closeCancelModal()"
>
</app-confirmation-modal>

<app-alert
  *ngIf="showAlert()"
  type="error"
  title="Error"
  [message]="alertMessage()"
  (onAccept)="showAlert.set(false)"
  (onClose)="showAlert.set(false)"
></app-alert>

<!-- Finalize Modal (Custom) -->
@if (showFinalizeModal()) {
  <div class="modal-backdrop" (click)="cancelFinalize()">
    <div class="modal-content finalize-modal" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Finalizar Auditoría de Caja</h2>
        <button type="button" class="btn-close" (click)="cancelFinalize()">✕</button>
      </div>
      
      <div class="modal-body">
        <div class="finalize-content">
          <p class="finalize-info">
            Ingrese el efectivo real contado en caja para cerrar la auditoría.
          </p>
          
          <div class="expected-cash-info">
            <strong>Efectivo esperado:</strong> {{ formattedTotal() }}
          </div>
          
          <div class="form-group">
            <label for="realCash">Efectivo Real Contado *</label>
            <input
              type="number"
              id="realCash"
              class="form-control"
              [(ngModel)]="realCash"
              [value]="realCash()"
              (ngModelChange)="realCash.set($event)"
              min="0"
              step="0.01"
              placeholder="0.00"
              required
            />
            <small class="help-text">Debe ser mayor o igual a 0</small>
          </div>
          
          @if (audit()?.total !== undefined && audit()?.total !== null && realCash()) {
            <div class="difference-preview">
              @let difference = realCash() - (audit()?.total || 0);
              @let absDifference = difference < 0 ? -difference : difference;
              @if (difference === 0) {
                <p class="difference-zero">Sin diferencias</p>
              } @else if (difference > 0) {
                <p class="difference-positive">Exceso: {{ difference | currency:'ARS':'symbol-narrow':'1.2-2':'es-AR' }}</p>
              } @else {
                <p class="difference-negative">Faltante: {{ absDifference | currency:'ARS':'symbol-narrow':'1.2-2':'es-AR' }}</p>
              }
            </div>
          }
        </div>
      </div>
      
      <div class="modal-footer">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="cancelFinalize()">
          Cancelar
        </button>
        
        <button 
          type="button" 
          class="btn btn-primary"
          (click)="confirmFinalize()">
          Finalizar Auditoría
        </button>
      </div>
    </div>
  </div>
}
