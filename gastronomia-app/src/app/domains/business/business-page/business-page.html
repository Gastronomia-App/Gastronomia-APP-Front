<div class="business-page">

  <!-- Page header (igual patrón que perfil) -->
  <header class="business-page-header">
    <div class="page-header-icon">
      <svg viewBox="0 0 16 16" aria-hidden="true">
        <path
          d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.37 2.37 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0M1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5M4 15h3v-5H4zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm3 0h-2v3h2z" />
      </svg>
    </div>
    <div class="page-header-text">
      <h1>Mi negocio</h1>
      <p>Gestiona la información general y configuración del negocio</p>
    </div>
  </header>

  <!-- Hero del negocio -->
  <section class="business-header-card">
    <div class="header-icon">
      <div class="header-icon-inner">
        <svg viewBox="0 0 16 16" aria-hidden="true">
          <path
            d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.37 2.37 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0M1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5M4 15h3v-5H4zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm3 0h-2v3h2z" />
        </svg>
      </div>
    </div>

    <div class="header-text">
      <h1 class="header-title">
        @if (myBusiness(); as business) {
        {{ business.name }}
        } @else {
        Mi negocio
        }
      </h1>
      <p class="header-subtitle">
        @if (myBusiness(); as business) {
        Propietario · {{ business.owner?.name }} {{ business.owner?.lastName }}
        } @else {
        Sin información del negocio
        }
      </p>
    </div>
  </section>

  @if (isLoading()) {
  <div class="state-card">
    <p class="state-text">Cargando información del negocio...</p>
  </div>
  }

  @if (errorMessage()) {
  <div class="state-card error">
    <p class="state-text">{{ errorMessage() }}</p>
  </div>
  }

  @if (showAlert()) {
  <app-alert
    type="error"
    title="Error"
    [message]="alertMessage() || ''"
    (onAccept)="showAlert.set(false)"
    (onClose)="showAlert.set(false)" />
}

  @if (!isLoading() && myBusiness(); as business) {

  <div class="business-layout">

    <!-- LEFT COLUMN: info component -->
    <section class="business-main-column">
      <app-business-info [business]="business"></app-business-info>

       @if (isEditMode()) {
        <app-business-form
          [business]="business"
          (submitForm)="onFormSubmit($event)"
          (cancel)="onCancelEdit()">
        </app-business-form>
      }
    </section>

    <!-- RIGHT COLUMN -->
    <aside class="business-side-column">

      <!-- EDIT CARD -->
      <article class="card edit-card">
        <h2 class="edit-card-title">Editar Negocio</h2>
        <p class="edit-card-subtitle">
          Actualiza la información y mantén tu perfil al día.
        </p>
        <button type="button" class="edit-card-button" (click)="onEditClick()" [disabled]="isEditMode()">
          Modificar mis datos
        </button>
        <button
  type="button"
  class="delete-card-button"
  (click)="onDeleteClick()">
  Eliminar negocio
</button>
      </article>

      <!-- TEAM CARD -->
      <article class="card team-card">
        <header class="team-header">
          <div class="team-header-left">
            <span class="team-header-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor"
                  d="M12 11c1.93 0 3.5-1.57 3.5-3.5S13.93 4 12 4 8.5 5.57 8.5 7.5 10.07 11 12 11zm-6 0C7.38 11 8.5 9.88 8.5 8.5S7.38 6 6 6 3.5 7.12 3.5 8.5 4.62 11 6 11zm12 0c1.38 0 2.5-1.12 2.5-2.5S19.38 6 18 6s-2.5 1.12-2.5 2.5S16.62 11 18 11zM12 13c-2.33 0-7 1.17-7 3.5V19h14v-2.5C19 14.17 14.33 13 12 13zm-6 0c-.7 0-1.51.09-2.32.28C2.64 13.59 2 14.23 2 15v4h2v-2.5C4 14.93 4.73 13.78 6 13.2 5.43 13.08 4.78 13 4 13zm12 0c-.78 0-1.43.08-2 .2 1.27.58 2 1.73 2 3.3V19h2v-4c0-.77-.64-1.41-1.68-1.72C17.51 13.09 16.7 13 16 13z" />
              </svg>
            </span>
            <span class="team-header-title">Equipo de Trabajo</span>
          </div>
        </header>

        <div class="team-body">
          <!-- Total employees circle -->
          <div class="team-count-wrapper">
            <div class="team-count-circle">
              {{ business.employeesCount ?? 0 }}
            </div>
            <p class="team-count-label">Empleados</p>
          </div>

          <div class="team-divider"></div>

          <!-- Active / inactive tiles -->
          <div class="team-metrics">

            <!-- Active employees -->
            <div class="team-metric team-metric-active">
              <div class="metric-left">
                <div class="metric-icon metric-icon-active">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <!-- User -->
                    <path
                      d="M12 12a3.75 3.75 0 1 0-3.75-3.75A3.75 3.75 0 0 0 12 12Zm0 1.5c-3.2 0-5.75 1.75-5.75 4.25V20h7"
                      fill="currentColor" />
                    <!-- Badge circle -->
                    <circle cx="17" cy="17" r="3.2" fill="none" stroke="currentColor" stroke-width="1.8" />
                    <!-- Check mark -->
                    <path d="M15.5 17 16.9 18.4 18.7 16.3" fill="none" stroke="currentColor" stroke-width="1.8"
                      stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </div>
                <div class="metric-text">
                  <span class="metric-label">Empleados activos</span>
                  <span class="metric-sub">En plantilla</span>
                </div>
              </div>
              <div class="metric-value">
                {{ business.activeEmployeesCount ?? 0 }}
              </div>
            </div>

            <!-- Inactive employees -->
            <div class="team-metric team-metric-inactive">
              <div class="metric-left">
                <div class="metric-icon metric-icon-inactive">
                  <!-- Inactive employees icon -->
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <!-- User -->
                    <path
                      d="M12 12a3.75 3.75 0 1 0-3.75-3.75A3.75 3.75 0 0 0 12 12Zm0 1.5c-3.2 0-5.75 1.75-5.75 4.25V20h7"
                      fill="currentColor" />
                    <!-- Badge circle -->
                    <circle cx="17" cy="17" r="3.2" fill="none" stroke="currentColor" stroke-width="1.8" />
                    <!-- X mark -->
                    <path d="M15.4 15.4 18.6 18.6M18.6 15.4 15.4 18.6" fill="none" stroke="currentColor"
                      stroke-width="1.7" stroke-linecap="round" />
                  </svg>

                </div>
                <div class="metric-text">
                  <span class="metric-label">Empleados inactivos</span>
                  <span class="metric-sub">Fuera de plantilla</span>
                </div>
              </div>
              <div class="metric-value metric-value-muted">
                {{ business.inactiveEmployeesCount ?? 0 }}
              </div>
            </div>

          </div>
        </div>
      </article>


    </aside>

  </div>
  }
</div>

@if (showDeleteConfirm()) {
  <app-business-delete
  [businessName]="myBusiness()?.name ?? 'Mi negocio'"
  [businessCuit]="myBusiness()?.cuit"
  (cancel)="onCancelDelete()"
  (confirmDelete)="onConfirmDelete()"
  (redirectAfterDelete)="onRedirectAfterDelete()">
</app-business-delete>
}