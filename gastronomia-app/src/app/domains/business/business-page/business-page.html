<div class="my-business-page">
  <div class="page-header">
    <h1>Mi Negocio</h1>
    @if (!isEditMode() && myBusiness()) {
      <div class="header-actions">
        <button class="action-btn edit" (click)="onEditClick()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M4 3h10a1 1 0 0 1 0 2H5v14h14v-9a1 1 0 0 1 2 0v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/>
            <path d="M20.707 2.293a1 1 0 0 0-1.414 0l-8.586 8.586a1 1 0 0 0-.263.465l-1 4a1 1 0 0 0 1.213 1.213l4-1a1 1 0 0 0 .465-.263l8.586-8.586a1 1 0 0 0 0-1.414l-3-3zM14.121 10L16 11.879 18.879 9 17 7.121 14.121 10z"/>
          </svg>
          Editar
        </button>
        <button class="action-btn delete" (click)="onDeleteClick()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
            <path d="M9 3h6a1 1 0 0 1 1 1v1h4a1 1 0 1 1 0 2H4a1 1 0 1 1 0-2h4V4a1 1 0 0 1 1-1z"/>
            <path d="M5 8h14l-1 12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 8z"/>
            <path d="M9 10a1 1 0 0 1 1 1v7a1 1 0 1 1-2 0v-7a1 1 0 0 1 1-1zm3 0a1 1 0 0 1 1 1v7a1 1 0 1 1-2 0v-7a1 1 0 0 1 1-1zm3 0a1 1 0 0 1 1 1v7a1 1 0 1 1-2 0v-7a1 1 0 0 1 1-1z"/>
          </svg>
          Eliminar
        </button>
      </div>
    }
  </div>

  @if (isLoading()) {
    <div class="loading-state">
      <p>Cargando información del negocio...</p>
    </div>
  }

  @if (errorMessage()) {
    <div class="error-state">
      <p>{{ errorMessage() }}</p>
    </div>
  }

  @if (showAlert()) {
  <app-alert
    type="error"
    title="Error"
    [message]="alertMessage() || ''"
    (onAccept)="showAlert.set(false)"
    (onClose)="showAlert.set(false)"
  />
}

  @if (myBusiness() && !isLoading()) {
    <div class="business-form-container">
      <app-business-form 
        [isEditMode]="isEditMode()"
        [editingBusinessId]="myBusiness()!.id ?? null"
        [businessData]="myBusiness()"
        (formSubmit)="onFormSubmit($event)"
        (formCancel)="onCancelEdit()">
      </app-business-form>
    </div>
  }
</div>

<!-- Confirmation Dialog for Save -->
@if (showSaveConfirm()) {
  <app-confirm
    title="Confirmar cambios"
    message="¿Estás seguro de que deseas guardar los cambios en tu negocio?"
    confirmLabel="Guardar"
    cancelLabel="Cancelar"
    (onConfirm)="onConfirmSave()"
    (onCancel)="onCancelSave()"
  />
}

<!-- Confirmation Dialog for Delete with text input -->
@if (showDeleteConfirm()) {
  <div class="confirm-backdrop" (click)="onBackdropClick($event)">
    <div class="confirm-dialog">
      <div class="confirm-header">
        <h2 class="confirm-title">Confirmar eliminación</h2>
      </div>
      
      <div class="confirm-body">
        <p class="confirm-message">
          Esta acción eliminará permanentemente tu negocio y no se puede deshacer.
        </p>
        <p class="confirm-message">
          Para confirmar, escribe <strong>"eliminar"</strong> en el campo de abajo:
        </p>
        <input 
          type="text" 
          class="delete-confirm-input"
          [(ngModel)]="deleteConfirmText"
          placeholder="Escribe 'eliminar' para confirmar"
          (input)="onDeleteInputChange()"
        />
      </div>
      
      <div class="confirm-footer">
        <button 
          type="button" 
          class="btn btn-cancel" 
          (click)="onCancelDelete()">
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn btn-confirm danger" 
          [disabled]="!isDeleteConfirmed()"
          (click)="onConfirmDelete()">
          Eliminar
        </button>
      </div>
    </div>
  </div>
}
