<div class="searchable-list-wrapper">
    <div class="search-container">
        <div class="search-input-wrapper">
            <input 
                type="text" 
                class="search-input" 
                [placeholder]="placeholder"
                [value]="searchQuery" 
                (input)="onSearch($event)"
                (focus)="searchFocus.emit()"
                (keydown)="onKeyDown($event)" />
            
            @if (showAddButton) {
                <button 
                    type="button" 
                    class="add-btn" 
                    (click)="addButtonClicked.emit()"
                    title="Abrir selector de productos">
                    +
                </button>
            }
        </div>

        @if(isLoading && searchQuery.trim() !== '') {
            <div class="loading-message">Cargando...</div>
        }

        @if(filteredItems.length > 0) {
            <div class="item-dropdown">
                @for(item of filteredItems; track item.id; let idx = $index) {
                    <div 
                        class="item" 
                        [class.highlighted]="isHighlighted(idx)"
                        (click)="addItem(item)"
                        (mouseenter)="highlightedIndex = idx">
                        <span class="item-name">{{ item.name }}</span>
                        @if(allowQuantitySelection && isHighlighted(idx) && pendingQuantity > 1) {
                            <span class="item-quantity-badge">x{{ pendingQuantity }}</span>
                        }
                    </div>
                }
            </div>
        }
    </div>
</div>
